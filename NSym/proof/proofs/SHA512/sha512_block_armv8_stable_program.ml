(* Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
  SPDX-License-Identifier: Apache-2.0*)

open Air;;
open Arm;;

(* Perl script:
   https://github.com/awslabs/aws-lc/blob/main/crypto/fipsmodule/sha/asm/sha512-armv8.pl
   Caller:
   https://github.com/awslabs/aws-lc/blob/main/crypto/fipsmodule/sha/sha512.c

   The following imperative version of the spec. is used in the SAW proofs:
   https://github.com/GaloisInc/cryptol-specs/blob/sha-imperative/Primitive/Keyless/Hash/SHA.cry#L65

   Unbounded Spec. for sha512_block_data_order:
   https://github.com/pennyannn/aws-lc-verification/blob/e05c3059937016b1e80c84c21cb53fd3d656a41b/SAW/proof/SHA512/SHA512-common.saw#L108
   Unbounded proof:
   https://github.com/pennyannn/aws-lc-verification/blob/e05c3059937016b1e80c84c21cb53fd3d656a41b/SAW/proof/SHA512/SHA512-common.saw#L375

   This version of the spec. is not used in the SAW proofs.
   https://github.com/GaloisInc/cryptol-specs/blob/master/Primitive/Keyless/Hash/SHA2/SHA.cry#L146

   https://github.com/GaloisInc/cryptol-specs/blob/master/Primitive/Keyless/Hash/SHA2/SHA512.cry

*)

(* Run AWS-LC test:
   cd aws-lc-build/crypto
   gdb --args ./crypto_test --gtest_filter=SHATest.SHA512ABI
*)

(* NIST/FIPS Specification and Test Vectors
   https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf#page=29
   https://csrc.nist.gov/CSRC/media/Projects/Cryptographic-Standards-and-Guidelines/documents/examples/SHA512.pdf
*)

let sha512_block_armv8 = [

  (* 00000000001264c0 <sha512_block_armv8>: *)
  (* 1264c0: *)         0xa9bf7bfd; (*  stp	x29, x30, [sp, #-16]!                         *)
  (* 1264c4: *)         0x910003fd; (*  mov	x29, sp                                       *)
  (* 1264c8: *)         0x4cdf2030; (*  ld1	{v16.16b-v19.16b}, [x1], #64                  *)
  (* 1264cc: *)         0x4cdf2034; (*  ld1	{v20.16b-v23.16b}, [x1], #64                  *)
  (* 1264d0: *)         0x4c402c00; (*  ld1	{v0.2d-v3.2d}, [x0]                           *)
  (* 1264d4: *)         0xd0000463; (*  adrp	x3, 1b4000 <ecp_nistz256_precomputed+0x25000> *)
  (* 1264d8: *)         0x910c0063; (*  add	x3, x3, #0x300                                *)
  (* 1264dc: *)         0x4e200a10; (*  rev64	v16.16b, v16.16b                              *)
  (* 1264e0: *)         0x4e200a31; (*  rev64	v17.16b, v17.16b                              *)
  (* 1264e4: *)         0x4e200a52; (*  rev64	v18.16b, v18.16b                              *)
  (* 1264e8: *)         0x4e200a73; (*  rev64	v19.16b, v19.16b                              *)
  (* 1264ec: *)         0x4e200a94; (*  rev64	v20.16b, v20.16b                              *)
  (* 1264f0: *)         0x4e200ab5; (*  rev64	v21.16b, v21.16b                              *)
  (* 1264f4: *)         0x4e200ad6; (*  rev64	v22.16b, v22.16b                              *)
  (* 1264f8: *)         0x4e200af7; (*  rev64	v23.16b, v23.16b                              *)
  (* 1264fc: *)         0x14000001; (*  b	126500 <sha512_block_armv8+0x40>              *)
  (* 126500: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126504: *)         0xf1000442; (*  subs	x2, x2, #0x1                                  *)
  (* 126508: *)         0xd1020024; (*  sub	x4, x1, #0x80                                 *)
  (* 12650c: *)         0x4ea01c1a; (*  mov	v26.16b, v0.16b                               *)
  (* 126510: *)         0x4ea11c3b; (*  mov	v27.16b, v1.16b                               *)
  (* 126514: *)         0x4ea21c5c; (*  mov	v28.16b, v2.16b                               *)
  (* 126518: *)         0x4ea31c7d; (*  mov	v29.16b, v3.16b                               *)
  (* 12651c: *)         0x9a841021; (*  csel	x1, x1, x4, ne  // ne = any                   *)
  (* 126520: *)         0x4ef08718; (*  add	v24.2d, v24.2d, v16.2d                        *)
  (* 126524: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126528: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 12652c: *)         0x6e034045; (*  ext	v5.16b, v2.16b, v3.16b, #8                    *)
  (* 126530: *)         0x6e024026; (*  ext	v6.16b, v1.16b, v2.16b, #8                    *)
  (* 126534: *)         0x4ef88463; (*  add	v3.2d, v3.2d, v24.2d                          *)
  (* 126538: *)         0xcec08230; (*  sha512su0	v16.2d, v17.2d                        *)
  (* 12653c: *)         0x6e154287; (*  ext	v7.16b, v20.16b, v21.16b, #8                  *)
  (* 126540: *)         0xce6680a3; (*  sha512h	q3, q5, v6.2d                                 *)
  (* 126544: *)         0xce678af0; (*  sha512su1	v16.2d, v23.2d, v7.2d                 *)
  (* 126548: *)         0x4ee38424; (*  add	v4.2d, v1.2d, v3.2d                           *)
  (* 12654c: *)         0xce608423; (*  sha512h2	q3, q1, v0.2d                         *)
  (* 126550: *)         0x4ef18739; (*  add	v25.2d, v25.2d, v17.2d                        *)
  (* 126554: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126558: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 12655c: *)         0x6e024085; (*  ext	v5.16b, v4.16b, v2.16b, #8                    *)
  (* 126560: *)         0x6e044006; (*  ext	v6.16b, v0.16b, v4.16b, #8                    *)
  (* 126564: *)         0x4ef98442; (*  add	v2.2d, v2.2d, v25.2d                          *)
  (* 126568: *)         0xcec08251; (*  sha512su0	v17.2d, v18.2d                        *)
  (* 12656c: *)         0x6e1642a7; (*  ext	v7.16b, v21.16b, v22.16b, #8                  *)
  (* 126570: *)         0xce6680a2; (*  sha512h	q2, q5, v6.2d                                 *)
  (* 126574: *)         0xce678a11; (*  sha512su1	v17.2d, v16.2d, v7.2d                 *)
  (* 126578: *)         0x4ee28401; (*  add	v1.2d, v0.2d, v2.2d                           *)
  (* 12657c: *)         0xce638402; (*  sha512h2	q2, q0, v3.2d                         *)
  (* 126580: *)         0x4ef28718; (*  add	v24.2d, v24.2d, v18.2d                        *)
  (* 126584: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126588: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 12658c: *)         0x6e044025; (*  ext	v5.16b, v1.16b, v4.16b, #8                    *)
  (* 126590: *)         0x6e014066; (*  ext	v6.16b, v3.16b, v1.16b, #8                    *)
  (* 126594: *)         0x4ef88484; (*  add	v4.2d, v4.2d, v24.2d                          *)
  (* 126598: *)         0xcec08272; (*  sha512su0	v18.2d, v19.2d                        *)
  (* 12659c: *)         0x6e1742c7; (*  ext	v7.16b, v22.16b, v23.16b, #8                  *)
  (* 1265a0: *)         0xce6680a4; (*  sha512h	q4, q5, v6.2d                                 *)
  (* 1265a4: *)         0xce678a32; (*  sha512su1	v18.2d, v17.2d, v7.2d                 *)
  (* 1265a8: *)         0x4ee48460; (*  add	v0.2d, v3.2d, v4.2d                           *)
  (* 1265ac: *)         0xce628464; (*  sha512h2	q4, q3, v2.2d                         *)
  (* 1265b0: *)         0x4ef38739; (*  add	v25.2d, v25.2d, v19.2d                        *)
  (* 1265b4: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 1265b8: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 1265bc: *)         0x6e014005; (*  ext	v5.16b, v0.16b, v1.16b, #8                    *)
  (* 1265c0: *)         0x6e004046; (*  ext	v6.16b, v2.16b, v0.16b, #8                    *)
  (* 1265c4: *)         0x4ef98421; (*  add	v1.2d, v1.2d, v25.2d                          *)
  (* 1265c8: *)         0xcec08293; (*  sha512su0	v19.2d, v20.2d                        *)
  (* 1265cc: *)         0x6e1042e7; (*  ext	v7.16b, v23.16b, v16.16b, #8                  *)
  (* 1265d0: *)         0xce6680a1; (*  sha512h	q1, q5, v6.2d                                 *)
  (* 1265d4: *)         0xce678a53; (*  sha512su1	v19.2d, v18.2d, v7.2d                 *)
  (* 1265d8: *)         0x4ee18443; (*  add	v3.2d, v2.2d, v1.2d                           *)
  (* 1265dc: *)         0xce648441; (*  sha512h2	q1, q2, v4.2d                         *)
  (* 1265e0: *)         0x4ef48718; (*  add	v24.2d, v24.2d, v20.2d                        *)
  (* 1265e4: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 1265e8: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 1265ec: *)         0x6e004065; (*  ext	v5.16b, v3.16b, v0.16b, #8                    *)
  (* 1265f0: *)         0x6e034086; (*  ext	v6.16b, v4.16b, v3.16b, #8                    *)
  (* 1265f4: *)         0x4ef88400; (*  add	v0.2d, v0.2d, v24.2d                          *)
  (* 1265f8: *)         0xcec082b4; (*  sha512su0	v20.2d, v21.2d                        *)
  (* 1265fc: *)         0x6e114207; (*  ext	v7.16b, v16.16b, v17.16b, #8                  *)
  (* 126600: *)         0xce6680a0; (*  sha512h	q0, q5, v6.2d                                 *)
  (* 126604: *)         0xce678a74; (*  sha512su1	v20.2d, v19.2d, v7.2d                 *)
  (* 126608: *)         0x4ee08482; (*  add	v2.2d, v4.2d, v0.2d                           *)
  (* 12660c: *)         0xce618480; (*  sha512h2	q0, q4, v1.2d                         *)
  (* 126610: *)         0x4ef58739; (*  add	v25.2d, v25.2d, v21.2d                        *)
  (* 126614: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126618: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 12661c: *)         0x6e034045; (*  ext	v5.16b, v2.16b, v3.16b, #8                    *)
  (* 126620: *)         0x6e024026; (*  ext	v6.16b, v1.16b, v2.16b, #8                    *)
  (* 126624: *)         0x4ef98463; (*  add	v3.2d, v3.2d, v25.2d                          *)
  (* 126628: *)         0xcec082d5; (*  sha512su0	v21.2d, v22.2d                        *)
  (* 12662c: *)         0x6e124227; (*  ext	v7.16b, v17.16b, v18.16b, #8                  *)
  (* 126630: *)         0xce6680a3; (*  sha512h	q3, q5, v6.2d                                 *)
  (* 126634: *)         0xce678a95; (*  sha512su1	v21.2d, v20.2d, v7.2d                 *)
  (* 126638: *)         0x4ee38424; (*  add	v4.2d, v1.2d, v3.2d                           *)
  (* 12663c: *)         0xce608423; (*  sha512h2	q3, q1, v0.2d                         *)
  (* 126640: *)         0x4ef68718; (*  add	v24.2d, v24.2d, v22.2d                        *)
  (* 126644: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126648: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 12664c: *)         0x6e024085; (*  ext	v5.16b, v4.16b, v2.16b, #8                    *)
  (* 126650: *)         0x6e044006; (*  ext	v6.16b, v0.16b, v4.16b, #8                    *)
  (* 126654: *)         0x4ef88442; (*  add	v2.2d, v2.2d, v24.2d                          *)
  (* 126658: *)         0xcec082f6; (*  sha512su0	v22.2d, v23.2d                        *)
  (* 12665c: *)         0x6e134247; (*  ext	v7.16b, v18.16b, v19.16b, #8                  *)
  (* 126660: *)         0xce6680a2; (*  sha512h	q2, q5, v6.2d                                 *)
  (* 126664: *)         0xce678ab6; (*  sha512su1	v22.2d, v21.2d, v7.2d                 *)
  (* 126668: *)         0x4ee28401; (*  add	v1.2d, v0.2d, v2.2d                           *)
  (* 12666c: *)         0xce638402; (*  sha512h2	q2, q0, v3.2d                         *)
  (* 126670: *)         0x4ef78739; (*  add	v25.2d, v25.2d, v23.2d                        *)
  (* 126674: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126678: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 12667c: *)         0x6e044025; (*  ext	v5.16b, v1.16b, v4.16b, #8                    *)
  (* 126680: *)         0x6e014066; (*  ext	v6.16b, v3.16b, v1.16b, #8                    *)
  (* 126684: *)         0x4ef98484; (*  add	v4.2d, v4.2d, v25.2d                          *)
  (* 126688: *)         0xcec08217; (*  sha512su0	v23.2d, v16.2d                        *)
  (* 12668c: *)         0x6e144267; (*  ext	v7.16b, v19.16b, v20.16b, #8                  *)
  (* 126690: *)         0xce6680a4; (*  sha512h	q4, q5, v6.2d                                 *)
  (* 126694: *)         0xce678ad7; (*  sha512su1	v23.2d, v22.2d, v7.2d                 *)
  (* 126698: *)         0x4ee48460; (*  add	v0.2d, v3.2d, v4.2d                           *)
  (* 12669c: *)         0xce628464; (*  sha512h2	q4, q3, v2.2d                         *)
  (* 1266a0: *)         0x4ef08718; (*  add	v24.2d, v24.2d, v16.2d                        *)
  (* 1266a4: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 1266a8: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 1266ac: *)         0x6e014005; (*  ext	v5.16b, v0.16b, v1.16b, #8                    *)
  (* 1266b0: *)         0x6e004046; (*  ext	v6.16b, v2.16b, v0.16b, #8                    *)
  (* 1266b4: *)         0x4ef88421; (*  add	v1.2d, v1.2d, v24.2d                          *)
  (* 1266b8: *)         0xcec08230; (*  sha512su0	v16.2d, v17.2d                        *)
  (* 1266bc: *)         0x6e154287; (*  ext	v7.16b, v20.16b, v21.16b, #8                  *)
  (* 1266c0: *)         0xce6680a1; (*  sha512h	q1, q5, v6.2d                                 *)
  (* 1266c4: *)         0xce678af0; (*  sha512su1	v16.2d, v23.2d, v7.2d                 *)
  (* 1266c8: *)         0x4ee18443; (*  add	v3.2d, v2.2d, v1.2d                           *)
  (* 1266cc: *)         0xce648441; (*  sha512h2	q1, q2, v4.2d                         *)
  (* 1266d0: *)         0x4ef18739; (*  add	v25.2d, v25.2d, v17.2d                        *)
  (* 1266d4: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 1266d8: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 1266dc: *)         0x6e004065; (*  ext	v5.16b, v3.16b, v0.16b, #8                    *)
  (* 1266e0: *)         0x6e034086; (*  ext	v6.16b, v4.16b, v3.16b, #8                    *)
  (* 1266e4: *)         0x4ef98400; (*  add	v0.2d, v0.2d, v25.2d                          *)
  (* 1266e8: *)         0xcec08251; (*  sha512su0	v17.2d, v18.2d                        *)
  (* 1266ec: *)         0x6e1642a7; (*  ext	v7.16b, v21.16b, v22.16b, #8                  *)
  (* 1266f0: *)         0xce6680a0; (*  sha512h	q0, q5, v6.2d                                 *)
  (* 1266f4: *)         0xce678a11; (*  sha512su1	v17.2d, v16.2d, v7.2d                 *)
  (* 1266f8: *)         0x4ee08482; (*  add	v2.2d, v4.2d, v0.2d                           *)
  (* 1266fc: *)         0xce618480; (*  sha512h2	q0, q4, v1.2d                         *)
  (* 126700: *)         0x4ef28718; (*  add	v24.2d, v24.2d, v18.2d                        *)
  (* 126704: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126708: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 12670c: *)         0x6e034045; (*  ext	v5.16b, v2.16b, v3.16b, #8                    *)
  (* 126710: *)         0x6e024026; (*  ext	v6.16b, v1.16b, v2.16b, #8                    *)
  (* 126714: *)         0x4ef88463; (*  add	v3.2d, v3.2d, v24.2d                          *)
  (* 126718: *)         0xcec08272; (*  sha512su0	v18.2d, v19.2d                        *)
  (* 12671c: *)         0x6e1742c7; (*  ext	v7.16b, v22.16b, v23.16b, #8                  *)
  (* 126720: *)         0xce6680a3; (*  sha512h	q3, q5, v6.2d                                 *)
  (* 126724: *)         0xce678a32; (*  sha512su1	v18.2d, v17.2d, v7.2d                 *)
  (* 126728: *)         0x4ee38424; (*  add	v4.2d, v1.2d, v3.2d                           *)
  (* 12672c: *)         0xce608423; (*  sha512h2	q3, q1, v0.2d                         *)
  (* 126730: *)         0x4ef38739; (*  add	v25.2d, v25.2d, v19.2d                        *)
  (* 126734: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126738: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 12673c: *)         0x6e024085; (*  ext	v5.16b, v4.16b, v2.16b, #8                    *)
  (* 126740: *)         0x6e044006; (*  ext	v6.16b, v0.16b, v4.16b, #8                    *)
  (* 126744: *)         0x4ef98442; (*  add	v2.2d, v2.2d, v25.2d                          *)
  (* 126748: *)         0xcec08293; (*  sha512su0	v19.2d, v20.2d                        *)
  (* 12674c: *)         0x6e1042e7; (*  ext	v7.16b, v23.16b, v16.16b, #8                  *)
  (* 126750: *)         0xce6680a2; (*  sha512h	q2, q5, v6.2d                                 *)
  (* 126754: *)         0xce678a53; (*  sha512su1	v19.2d, v18.2d, v7.2d                 *)
  (* 126758: *)         0x4ee28401; (*  add	v1.2d, v0.2d, v2.2d                           *)
  (* 12675c: *)         0xce638402; (*  sha512h2	q2, q0, v3.2d                         *)
  (* 126760: *)         0x4ef48718; (*  add	v24.2d, v24.2d, v20.2d                        *)
  (* 126764: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126768: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 12676c: *)         0x6e044025; (*  ext	v5.16b, v1.16b, v4.16b, #8                    *)
  (* 126770: *)         0x6e014066; (*  ext	v6.16b, v3.16b, v1.16b, #8                    *)
  (* 126774: *)         0x4ef88484; (*  add	v4.2d, v4.2d, v24.2d                          *)
  (* 126778: *)         0xcec082b4; (*  sha512su0	v20.2d, v21.2d                        *)
  (* 12677c: *)         0x6e114207; (*  ext	v7.16b, v16.16b, v17.16b, #8                  *)
  (* 126780: *)         0xce6680a4; (*  sha512h	q4, q5, v6.2d                                 *)
  (* 126784: *)         0xce678a74; (*  sha512su1	v20.2d, v19.2d, v7.2d                 *)
  (* 126788: *)         0x4ee48460; (*  add	v0.2d, v3.2d, v4.2d                           *)
  (* 12678c: *)         0xce628464; (*  sha512h2	q4, q3, v2.2d                         *)
  (* 126790: *)         0x4ef58739; (*  add	v25.2d, v25.2d, v21.2d                        *)
  (* 126794: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126798: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 12679c: *)         0x6e014005; (*  ext	v5.16b, v0.16b, v1.16b, #8                    *)
  (* 1267a0: *)         0x6e004046; (*  ext	v6.16b, v2.16b, v0.16b, #8                    *)
  (* 1267a4: *)         0x4ef98421; (*  add	v1.2d, v1.2d, v25.2d                          *)
  (* 1267a8: *)         0xcec082d5; (*  sha512su0	v21.2d, v22.2d                        *)
  (* 1267ac: *)         0x6e124227; (*  ext	v7.16b, v17.16b, v18.16b, #8                  *)
  (* 1267b0: *)         0xce6680a1; (*  sha512h	q1, q5, v6.2d                                 *)
  (* 1267b4: *)         0xce678a95; (*  sha512su1	v21.2d, v20.2d, v7.2d                 *)
  (* 1267b8: *)         0x4ee18443; (*  add	v3.2d, v2.2d, v1.2d                           *)
  (* 1267bc: *)         0xce648441; (*  sha512h2	q1, q2, v4.2d                         *)
  (* 1267c0: *)         0x4ef68718; (*  add	v24.2d, v24.2d, v22.2d                        *)
  (* 1267c4: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 1267c8: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 1267cc: *)         0x6e004065; (*  ext	v5.16b, v3.16b, v0.16b, #8                    *)
  (* 1267d0: *)         0x6e034086; (*  ext	v6.16b, v4.16b, v3.16b, #8                    *)
  (* 1267d4: *)         0x4ef88400; (*  add	v0.2d, v0.2d, v24.2d                          *)
  (* 1267d8: *)         0xcec082f6; (*  sha512su0	v22.2d, v23.2d                        *)
  (* 1267dc: *)         0x6e134247; (*  ext	v7.16b, v18.16b, v19.16b, #8                  *)
  (* 1267e0: *)         0xce6680a0; (*  sha512h	q0, q5, v6.2d                                 *)
  (* 1267e4: *)         0xce678ab6; (*  sha512su1	v22.2d, v21.2d, v7.2d                 *)
  (* 1267e8: *)         0x4ee08482; (*  add	v2.2d, v4.2d, v0.2d                           *)
  (* 1267ec: *)         0xce618480; (*  sha512h2	q0, q4, v1.2d                         *)
  (* 1267f0: *)         0x4ef78739; (*  add	v25.2d, v25.2d, v23.2d                        *)
  (* 1267f4: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 1267f8: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 1267fc: *)         0x6e034045; (*  ext	v5.16b, v2.16b, v3.16b, #8                    *)
  (* 126800: *)         0x6e024026; (*  ext	v6.16b, v1.16b, v2.16b, #8                    *)
  (* 126804: *)         0x4ef98463; (*  add	v3.2d, v3.2d, v25.2d                          *)
  (* 126808: *)         0xcec08217; (*  sha512su0	v23.2d, v16.2d                        *)
  (* 12680c: *)         0x6e144267; (*  ext	v7.16b, v19.16b, v20.16b, #8                  *)
  (* 126810: *)         0xce6680a3; (*  sha512h	q3, q5, v6.2d                                 *)
  (* 126814: *)         0xce678ad7; (*  sha512su1	v23.2d, v22.2d, v7.2d                 *)
  (* 126818: *)         0x4ee38424; (*  add	v4.2d, v1.2d, v3.2d                           *)
  (* 12681c: *)         0xce608423; (*  sha512h2	q3, q1, v0.2d                         *)
  (* 126820: *)         0x4ef08718; (*  add	v24.2d, v24.2d, v16.2d                        *)
  (* 126824: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126828: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 12682c: *)         0x6e024085; (*  ext	v5.16b, v4.16b, v2.16b, #8                    *)
  (* 126830: *)         0x6e044006; (*  ext	v6.16b, v0.16b, v4.16b, #8                    *)
  (* 126834: *)         0x4ef88442; (*  add	v2.2d, v2.2d, v24.2d                          *)
  (* 126838: *)         0xcec08230; (*  sha512su0	v16.2d, v17.2d                        *)
  (* 12683c: *)         0x6e154287; (*  ext	v7.16b, v20.16b, v21.16b, #8                  *)
  (* 126840: *)         0xce6680a2; (*  sha512h	q2, q5, v6.2d                                 *)
  (* 126844: *)         0xce678af0; (*  sha512su1	v16.2d, v23.2d, v7.2d                 *)
  (* 126848: *)         0x4ee28401; (*  add	v1.2d, v0.2d, v2.2d                           *)
  (* 12684c: *)         0xce638402; (*  sha512h2	q2, q0, v3.2d                         *)
  (* 126850: *)         0x4ef18739; (*  add	v25.2d, v25.2d, v17.2d                        *)
  (* 126854: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126858: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 12685c: *)         0x6e044025; (*  ext	v5.16b, v1.16b, v4.16b, #8                    *)
  (* 126860: *)         0x6e014066; (*  ext	v6.16b, v3.16b, v1.16b, #8                    *)
  (* 126864: *)         0x4ef98484; (*  add	v4.2d, v4.2d, v25.2d                          *)
  (* 126868: *)         0xcec08251; (*  sha512su0	v17.2d, v18.2d                        *)
  (* 12686c: *)         0x6e1642a7; (*  ext	v7.16b, v21.16b, v22.16b, #8                  *)
  (* 126870: *)         0xce6680a4; (*  sha512h	q4, q5, v6.2d                                 *)
  (* 126874: *)         0xce678a11; (*  sha512su1	v17.2d, v16.2d, v7.2d                 *)
  (* 126878: *)         0x4ee48460; (*  add	v0.2d, v3.2d, v4.2d                           *)
  (* 12687c: *)         0xce628464; (*  sha512h2	q4, q3, v2.2d                         *)
  (* 126880: *)         0x4ef28718; (*  add	v24.2d, v24.2d, v18.2d                        *)
  (* 126884: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126888: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 12688c: *)         0x6e014005; (*  ext	v5.16b, v0.16b, v1.16b, #8                    *)
  (* 126890: *)         0x6e004046; (*  ext	v6.16b, v2.16b, v0.16b, #8                    *)
  (* 126894: *)         0x4ef88421; (*  add	v1.2d, v1.2d, v24.2d                          *)
  (* 126898: *)         0xcec08272; (*  sha512su0	v18.2d, v19.2d                        *)
  (* 12689c: *)         0x6e1742c7; (*  ext	v7.16b, v22.16b, v23.16b, #8                  *)
  (* 1268a0: *)         0xce6680a1; (*  sha512h	q1, q5, v6.2d                                 *)
  (* 1268a4: *)         0xce678a32; (*  sha512su1	v18.2d, v17.2d, v7.2d                 *)
  (* 1268a8: *)         0x4ee18443; (*  add	v3.2d, v2.2d, v1.2d                           *)
  (* 1268ac: *)         0xce648441; (*  sha512h2	q1, q2, v4.2d                         *)
  (* 1268b0: *)         0x4ef38739; (*  add	v25.2d, v25.2d, v19.2d                        *)
  (* 1268b4: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 1268b8: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 1268bc: *)         0x6e004065; (*  ext	v5.16b, v3.16b, v0.16b, #8                    *)
  (* 1268c0: *)         0x6e034086; (*  ext	v6.16b, v4.16b, v3.16b, #8                    *)
  (* 1268c4: *)         0x4ef98400; (*  add	v0.2d, v0.2d, v25.2d                          *)
  (* 1268c8: *)         0xcec08293; (*  sha512su0	v19.2d, v20.2d                        *)
  (* 1268cc: *)         0x6e1042e7; (*  ext	v7.16b, v23.16b, v16.16b, #8                  *)
  (* 1268d0: *)         0xce6680a0; (*  sha512h	q0, q5, v6.2d                                 *)
  (* 1268d4: *)         0xce678a53; (*  sha512su1	v19.2d, v18.2d, v7.2d                 *)
  (* 1268d8: *)         0x4ee08482; (*  add	v2.2d, v4.2d, v0.2d                           *)
  (* 1268dc: *)         0xce618480; (*  sha512h2	q0, q4, v1.2d                         *)
  (* 1268e0: *)         0x4ef48718; (*  add	v24.2d, v24.2d, v20.2d                        *)
  (* 1268e4: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 1268e8: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 1268ec: *)         0x6e034045; (*  ext	v5.16b, v2.16b, v3.16b, #8                    *)
  (* 1268f0: *)         0x6e024026; (*  ext	v6.16b, v1.16b, v2.16b, #8                    *)
  (* 1268f4: *)         0x4ef88463; (*  add	v3.2d, v3.2d, v24.2d                          *)
  (* 1268f8: *)         0xcec082b4; (*  sha512su0	v20.2d, v21.2d                        *)
  (* 1268fc: *)         0x6e114207; (*  ext	v7.16b, v16.16b, v17.16b, #8                  *)
  (* 126900: *)         0xce6680a3; (*  sha512h	q3, q5, v6.2d                                 *)
  (* 126904: *)         0xce678a74; (*  sha512su1	v20.2d, v19.2d, v7.2d                 *)
  (* 126908: *)         0x4ee38424; (*  add	v4.2d, v1.2d, v3.2d                           *)
  (* 12690c: *)         0xce608423; (*  sha512h2	q3, q1, v0.2d                         *)
  (* 126910: *)         0x4ef58739; (*  add	v25.2d, v25.2d, v21.2d                        *)
  (* 126914: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126918: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 12691c: *)         0x6e024085; (*  ext	v5.16b, v4.16b, v2.16b, #8                    *)
  (* 126920: *)         0x6e044006; (*  ext	v6.16b, v0.16b, v4.16b, #8                    *)
  (* 126924: *)         0x4ef98442; (*  add	v2.2d, v2.2d, v25.2d                          *)
  (* 126928: *)         0xcec082d5; (*  sha512su0	v21.2d, v22.2d                        *)
  (* 12692c: *)         0x6e124227; (*  ext	v7.16b, v17.16b, v18.16b, #8                  *)
  (* 126930: *)         0xce6680a2; (*  sha512h	q2, q5, v6.2d                                 *)
  (* 126934: *)         0xce678a95; (*  sha512su1	v21.2d, v20.2d, v7.2d                 *)
  (* 126938: *)         0x4ee28401; (*  add	v1.2d, v0.2d, v2.2d                           *)
  (* 12693c: *)         0xce638402; (*  sha512h2	q2, q0, v3.2d                         *)
  (* 126940: *)         0x4ef68718; (*  add	v24.2d, v24.2d, v22.2d                        *)
  (* 126944: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126948: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 12694c: *)         0x6e044025; (*  ext	v5.16b, v1.16b, v4.16b, #8                    *)
  (* 126950: *)         0x6e014066; (*  ext	v6.16b, v3.16b, v1.16b, #8                    *)
  (* 126954: *)         0x4ef88484; (*  add	v4.2d, v4.2d, v24.2d                          *)
  (* 126958: *)         0xcec082f6; (*  sha512su0	v22.2d, v23.2d                        *)
  (* 12695c: *)         0x6e134247; (*  ext	v7.16b, v18.16b, v19.16b, #8                  *)
  (* 126960: *)         0xce6680a4; (*  sha512h	q4, q5, v6.2d                                 *)
  (* 126964: *)         0xce678ab6; (*  sha512su1	v22.2d, v21.2d, v7.2d                 *)
  (* 126968: *)         0x4ee48460; (*  add	v0.2d, v3.2d, v4.2d                           *)
  (* 12696c: *)         0xce628464; (*  sha512h2	q4, q3, v2.2d                         *)
  (* 126970: *)         0x4ef78739; (*  add	v25.2d, v25.2d, v23.2d                        *)
  (* 126974: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126978: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 12697c: *)         0x6e014005; (*  ext	v5.16b, v0.16b, v1.16b, #8                    *)
  (* 126980: *)         0x6e004046; (*  ext	v6.16b, v2.16b, v0.16b, #8                    *)
  (* 126984: *)         0x4ef98421; (*  add	v1.2d, v1.2d, v25.2d                          *)
  (* 126988: *)         0xcec08217; (*  sha512su0	v23.2d, v16.2d                        *)
  (* 12698c: *)         0x6e144267; (*  ext	v7.16b, v19.16b, v20.16b, #8                  *)
  (* 126990: *)         0xce6680a1; (*  sha512h	q1, q5, v6.2d                                 *)
  (* 126994: *)         0xce678ad7; (*  sha512su1	v23.2d, v22.2d, v7.2d                 *)
  (* 126998: *)         0x4ee18443; (*  add	v3.2d, v2.2d, v1.2d                           *)
  (* 12699c: *)         0xce648441; (*  sha512h2	q1, q2, v4.2d                         *)
  (* 1269a0: *)         0x4ef08718; (*  add	v24.2d, v24.2d, v16.2d                        *)
  (* 1269a4: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 1269a8: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 1269ac: *)         0x6e004065; (*  ext	v5.16b, v3.16b, v0.16b, #8                    *)
  (* 1269b0: *)         0x6e034086; (*  ext	v6.16b, v4.16b, v3.16b, #8                    *)
  (* 1269b4: *)         0x4ef88400; (*  add	v0.2d, v0.2d, v24.2d                          *)
  (* 1269b8: *)         0xcec08230; (*  sha512su0	v16.2d, v17.2d                        *)
  (* 1269bc: *)         0x6e154287; (*  ext	v7.16b, v20.16b, v21.16b, #8                  *)
  (* 1269c0: *)         0xce6680a0; (*  sha512h	q0, q5, v6.2d                                 *)
  (* 1269c4: *)         0xce678af0; (*  sha512su1	v16.2d, v23.2d, v7.2d                 *)
  (* 1269c8: *)         0x4ee08482; (*  add	v2.2d, v4.2d, v0.2d                           *)
  (* 1269cc: *)         0xce618480; (*  sha512h2	q0, q4, v1.2d                         *)
  (* 1269d0: *)         0x4ef18739; (*  add	v25.2d, v25.2d, v17.2d                        *)
  (* 1269d4: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 1269d8: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 1269dc: *)         0x6e034045; (*  ext	v5.16b, v2.16b, v3.16b, #8                    *)
  (* 1269e0: *)         0x6e024026; (*  ext	v6.16b, v1.16b, v2.16b, #8                    *)
  (* 1269e4: *)         0x4ef98463; (*  add	v3.2d, v3.2d, v25.2d                          *)
  (* 1269e8: *)         0xcec08251; (*  sha512su0	v17.2d, v18.2d                        *)
  (* 1269ec: *)         0x6e1642a7; (*  ext	v7.16b, v21.16b, v22.16b, #8                  *)
  (* 1269f0: *)         0xce6680a3; (*  sha512h	q3, q5, v6.2d                                 *)
  (* 1269f4: *)         0xce678a11; (*  sha512su1	v17.2d, v16.2d, v7.2d                 *)
  (* 1269f8: *)         0x4ee38424; (*  add	v4.2d, v1.2d, v3.2d                           *)
  (* 1269fc: *)         0xce608423; (*  sha512h2	q3, q1, v0.2d                         *)
  (* 126a00: *)         0x4ef28718; (*  add	v24.2d, v24.2d, v18.2d                        *)
  (* 126a04: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126a08: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 126a0c: *)         0x6e024085; (*  ext	v5.16b, v4.16b, v2.16b, #8                    *)
  (* 126a10: *)         0x6e044006; (*  ext	v6.16b, v0.16b, v4.16b, #8                    *)
  (* 126a14: *)         0x4ef88442; (*  add	v2.2d, v2.2d, v24.2d                          *)
  (* 126a18: *)         0xcec08272; (*  sha512su0	v18.2d, v19.2d                        *)
  (* 126a1c: *)         0x6e1742c7; (*  ext	v7.16b, v22.16b, v23.16b, #8                  *)
  (* 126a20: *)         0xce6680a2; (*  sha512h	q2, q5, v6.2d                                 *)
  (* 126a24: *)         0xce678a32; (*  sha512su1	v18.2d, v17.2d, v7.2d                 *)
  (* 126a28: *)         0x4ee28401; (*  add	v1.2d, v0.2d, v2.2d                           *)
  (* 126a2c: *)         0xce638402; (*  sha512h2	q2, q0, v3.2d                         *)
  (* 126a30: *)         0x4ef38739; (*  add	v25.2d, v25.2d, v19.2d                        *)
  (* 126a34: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126a38: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 126a3c: *)         0x6e044025; (*  ext	v5.16b, v1.16b, v4.16b, #8                    *)
  (* 126a40: *)         0x6e014066; (*  ext	v6.16b, v3.16b, v1.16b, #8                    *)
  (* 126a44: *)         0x4ef98484; (*  add	v4.2d, v4.2d, v25.2d                          *)
  (* 126a48: *)         0xcec08293; (*  sha512su0	v19.2d, v20.2d                        *)
  (* 126a4c: *)         0x6e1042e7; (*  ext	v7.16b, v23.16b, v16.16b, #8                  *)
  (* 126a50: *)         0xce6680a4; (*  sha512h	q4, q5, v6.2d                                 *)
  (* 126a54: *)         0xce678a53; (*  sha512su1	v19.2d, v18.2d, v7.2d                 *)
  (* 126a58: *)         0x4ee48460; (*  add	v0.2d, v3.2d, v4.2d                           *)
  (* 126a5c: *)         0xce628464; (*  sha512h2	q4, q3, v2.2d                         *)
  (* 126a60: *)         0x4ef48718; (*  add	v24.2d, v24.2d, v20.2d                        *)
  (* 126a64: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126a68: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 126a6c: *)         0x6e014005; (*  ext	v5.16b, v0.16b, v1.16b, #8                    *)
  (* 126a70: *)         0x6e004046; (*  ext	v6.16b, v2.16b, v0.16b, #8                    *)
  (* 126a74: *)         0x4ef88421; (*  add	v1.2d, v1.2d, v24.2d                          *)
  (* 126a78: *)         0xcec082b4; (*  sha512su0	v20.2d, v21.2d                        *)
  (* 126a7c: *)         0x6e114207; (*  ext	v7.16b, v16.16b, v17.16b, #8                  *)
  (* 126a80: *)         0xce6680a1; (*  sha512h	q1, q5, v6.2d                                 *)
  (* 126a84: *)         0xce678a74; (*  sha512su1	v20.2d, v19.2d, v7.2d                 *)
  (* 126a88: *)         0x4ee18443; (*  add	v3.2d, v2.2d, v1.2d                           *)
  (* 126a8c: *)         0xce648441; (*  sha512h2	q1, q2, v4.2d                         *)
  (* 126a90: *)         0x4ef58739; (*  add	v25.2d, v25.2d, v21.2d                        *)
  (* 126a94: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126a98: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 126a9c: *)         0x6e004065; (*  ext	v5.16b, v3.16b, v0.16b, #8                    *)
  (* 126aa0: *)         0x6e034086; (*  ext	v6.16b, v4.16b, v3.16b, #8                    *)
  (* 126aa4: *)         0x4ef98400; (*  add	v0.2d, v0.2d, v25.2d                          *)
  (* 126aa8: *)         0xcec082d5; (*  sha512su0	v21.2d, v22.2d                        *)
  (* 126aac: *)         0x6e124227; (*  ext	v7.16b, v17.16b, v18.16b, #8                  *)
  (* 126ab0: *)         0xce6680a0; (*  sha512h	q0, q5, v6.2d                                 *)
  (* 126ab4: *)         0xce678a95; (*  sha512su1	v21.2d, v20.2d, v7.2d                 *)
  (* 126ab8: *)         0x4ee08482; (*  add	v2.2d, v4.2d, v0.2d                           *)
  (* 126abc: *)         0xce618480; (*  sha512h2	q0, q4, v1.2d                         *)
  (* 126ac0: *)         0x4ef68718; (*  add	v24.2d, v24.2d, v22.2d                        *)
  (* 126ac4: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126ac8: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 126acc: *)         0x6e034045; (*  ext	v5.16b, v2.16b, v3.16b, #8                    *)
  (* 126ad0: *)         0x6e024026; (*  ext	v6.16b, v1.16b, v2.16b, #8                    *)
  (* 126ad4: *)         0x4ef88463; (*  add	v3.2d, v3.2d, v24.2d                          *)
  (* 126ad8: *)         0xcec082f6; (*  sha512su0	v22.2d, v23.2d                        *)
  (* 126adc: *)         0x6e134247; (*  ext	v7.16b, v18.16b, v19.16b, #8                  *)
  (* 126ae0: *)         0xce6680a3; (*  sha512h	q3, q5, v6.2d                                 *)
  (* 126ae4: *)         0xce678ab6; (*  sha512su1	v22.2d, v21.2d, v7.2d                 *)
  (* 126ae8: *)         0x4ee38424; (*  add	v4.2d, v1.2d, v3.2d                           *)
  (* 126aec: *)         0xce608423; (*  sha512h2	q3, q1, v0.2d                         *)
  (* 126af0: *)         0x4ef78739; (*  add	v25.2d, v25.2d, v23.2d                        *)
  (* 126af4: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126af8: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 126afc: *)         0x6e024085; (*  ext	v5.16b, v4.16b, v2.16b, #8                    *)
  (* 126b00: *)         0x6e044006; (*  ext	v6.16b, v0.16b, v4.16b, #8                    *)
  (* 126b04: *)         0x4ef98442; (*  add	v2.2d, v2.2d, v25.2d                          *)
  (* 126b08: *)         0xcec08217; (*  sha512su0	v23.2d, v16.2d                        *)
  (* 126b0c: *)         0x6e144267; (*  ext	v7.16b, v19.16b, v20.16b, #8                  *)
  (* 126b10: *)         0xce6680a2; (*  sha512h	q2, q5, v6.2d                                 *)
  (* 126b14: *)         0xce678ad7; (*  sha512su1	v23.2d, v22.2d, v7.2d                 *)
  (* 126b18: *)         0x4ee28401; (*  add	v1.2d, v0.2d, v2.2d                           *)
  (* 126b1c: *)         0xce638402; (*  sha512h2	q2, q0, v3.2d                         *)
  (* 126b20: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126b24: *)         0x4ef08718; (*  add	v24.2d, v24.2d, v16.2d                        *)
  (* 126b28: *)         0x4cdf7030; (*  ld1	{v16.16b}, [x1], #16                          *)
  (* 126b2c: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 126b30: *)         0x6e044025; (*  ext	v5.16b, v1.16b, v4.16b, #8                    *)
  (* 126b34: *)         0x6e014066; (*  ext	v6.16b, v3.16b, v1.16b, #8                    *)
  (* 126b38: *)         0x4ef88484; (*  add	v4.2d, v4.2d, v24.2d                          *)
  (* 126b3c: *)         0xce6680a4; (*  sha512h	q4, q5, v6.2d                                 *)
  (* 126b40: *)         0x4e200a10; (*  rev64	v16.16b, v16.16b                              *)
  (* 126b44: *)         0x4ee48460; (*  add	v0.2d, v3.2d, v4.2d                           *)
  (* 126b48: *)         0xce628464; (*  sha512h2	q4, q3, v2.2d                         *)
  (* 126b4c: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126b50: *)         0x4ef18739; (*  add	v25.2d, v25.2d, v17.2d                        *)
  (* 126b54: *)         0x4cdf7031; (*  ld1	{v17.16b}, [x1], #16                          *)
  (* 126b58: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 126b5c: *)         0x6e014005; (*  ext	v5.16b, v0.16b, v1.16b, #8                    *)
  (* 126b60: *)         0x6e004046; (*  ext	v6.16b, v2.16b, v0.16b, #8                    *)
  (* 126b64: *)         0x4ef98421; (*  add	v1.2d, v1.2d, v25.2d                          *)
  (* 126b68: *)         0xce6680a1; (*  sha512h	q1, q5, v6.2d                                 *)
  (* 126b6c: *)         0x4e200a31; (*  rev64	v17.16b, v17.16b                              *)
  (* 126b70: *)         0x4ee18443; (*  add	v3.2d, v2.2d, v1.2d                           *)
  (* 126b74: *)         0xce648441; (*  sha512h2	q1, q2, v4.2d                         *)
  (* 126b78: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126b7c: *)         0x4ef28718; (*  add	v24.2d, v24.2d, v18.2d                        *)
  (* 126b80: *)         0x4cdf7032; (*  ld1	{v18.16b}, [x1], #16                          *)
  (* 126b84: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 126b88: *)         0x6e004065; (*  ext	v5.16b, v3.16b, v0.16b, #8                    *)
  (* 126b8c: *)         0x6e034086; (*  ext	v6.16b, v4.16b, v3.16b, #8                    *)
  (* 126b90: *)         0x4ef88400; (*  add	v0.2d, v0.2d, v24.2d                          *)
  (* 126b94: *)         0xce6680a0; (*  sha512h	q0, q5, v6.2d                                 *)
  (* 126b98: *)         0x4e200a52; (*  rev64	v18.16b, v18.16b                              *)
  (* 126b9c: *)         0x4ee08482; (*  add	v2.2d, v4.2d, v0.2d                           *)
  (* 126ba0: *)         0xce618480; (*  sha512h2	q0, q4, v1.2d                         *)
  (* 126ba4: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126ba8: *)         0x4ef38739; (*  add	v25.2d, v25.2d, v19.2d                        *)
  (* 126bac: *)         0x4cdf7033; (*  ld1	{v19.16b}, [x1], #16                          *)
  (* 126bb0: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 126bb4: *)         0x6e034045; (*  ext	v5.16b, v2.16b, v3.16b, #8                    *)
  (* 126bb8: *)         0x6e024026; (*  ext	v6.16b, v1.16b, v2.16b, #8                    *)
  (* 126bbc: *)         0x4ef98463; (*  add	v3.2d, v3.2d, v25.2d                          *)
  (* 126bc0: *)         0xce6680a3; (*  sha512h	q3, q5, v6.2d                                 *)
  (* 126bc4: *)         0x4e200a73; (*  rev64	v19.16b, v19.16b                              *)
  (* 126bc8: *)         0x4ee38424; (*  add	v4.2d, v1.2d, v3.2d                           *)
  (* 126bcc: *)         0xce608423; (*  sha512h2	q3, q1, v0.2d                         *)
  (* 126bd0: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126bd4: *)         0x4ef48718; (*  add	v24.2d, v24.2d, v20.2d                        *)
  (* 126bd8: *)         0x4cdf7034; (*  ld1	{v20.16b}, [x1], #16                          *)
  (* 126bdc: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 126be0: *)         0x6e024085; (*  ext	v5.16b, v4.16b, v2.16b, #8                    *)
  (* 126be4: *)         0x6e044006; (*  ext	v6.16b, v0.16b, v4.16b, #8                    *)
  (* 126be8: *)         0x4ef88442; (*  add	v2.2d, v2.2d, v24.2d                          *)
  (* 126bec: *)         0xce6680a2; (*  sha512h	q2, q5, v6.2d                                 *)
  (* 126bf0: *)         0x4e200a94; (*  rev64	v20.16b, v20.16b                              *)
  (* 126bf4: *)         0x4ee28401; (*  add	v1.2d, v0.2d, v2.2d                           *)
  (* 126bf8: *)         0xce638402; (*  sha512h2	q2, q0, v3.2d                         *)
  (* 126bfc: *)         0x4cdf7c78; (*  ld1	{v24.2d}, [x3], #16                           *)
  (* 126c00: *)         0x4ef58739; (*  add	v25.2d, v25.2d, v21.2d                        *)
  (* 126c04: *)         0x4cdf7035; (*  ld1	{v21.16b}, [x1], #16                          *)
  (* 126c08: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 126c0c: *)         0x6e044025; (*  ext	v5.16b, v1.16b, v4.16b, #8                    *)
  (* 126c10: *)         0x6e014066; (*  ext	v6.16b, v3.16b, v1.16b, #8                    *)
  (* 126c14: *)         0x4ef98484; (*  add	v4.2d, v4.2d, v25.2d                          *)
  (* 126c18: *)         0xce6680a4; (*  sha512h	q4, q5, v6.2d                                 *)
  (* 126c1c: *)         0x4e200ab5; (*  rev64	v21.16b, v21.16b                              *)
  (* 126c20: *)         0x4ee48460; (*  add	v0.2d, v3.2d, v4.2d                           *)
  (* 126c24: *)         0xce628464; (*  sha512h2	q4, q3, v2.2d                         *)
  (* 126c28: *)         0x4cdf7c79; (*  ld1	{v25.2d}, [x3], #16                           *)
  (* 126c2c: *)         0x4ef68718; (*  add	v24.2d, v24.2d, v22.2d                        *)
  (* 126c30: *)         0x4cdf7036; (*  ld1	{v22.16b}, [x1], #16                          *)
  (* 126c34: *)         0x6e184318; (*  ext	v24.16b, v24.16b, v24.16b, #8                 *)
  (* 126c38: *)         0x6e014005; (*  ext	v5.16b, v0.16b, v1.16b, #8                    *)
  (* 126c3c: *)         0x6e004046; (*  ext	v6.16b, v2.16b, v0.16b, #8                    *)
  (* 126c40: *)         0x4ef88421; (*  add	v1.2d, v1.2d, v24.2d                          *)
  (* 126c44: *)         0xce6680a1; (*  sha512h	q1, q5, v6.2d                                 *)
  (* 126c48: *)         0x4e200ad6; (*  rev64	v22.16b, v22.16b                              *)
  (* 126c4c: *)         0x4ee18443; (*  add	v3.2d, v2.2d, v1.2d                           *)
  (* 126c50: *)         0xce648441; (*  sha512h2	q1, q2, v4.2d                         *)
  (* 126c54: *)         0xd10a0063; (*  sub	x3, x3, #0x280                                *)
  (* 126c58: *)         0x4ef78739; (*  add	v25.2d, v25.2d, v23.2d                        *)
  (* 126c5c: *)         0x4cdf7037; (*  ld1	{v23.16b}, [x1], #16                          *)
  (* 126c60: *)         0x6e194339; (*  ext	v25.16b, v25.16b, v25.16b, #8                 *)
  (* 126c64: *)         0x6e004065; (*  ext	v5.16b, v3.16b, v0.16b, #8                    *)
  (* 126c68: *)         0x6e034086; (*  ext	v6.16b, v4.16b, v3.16b, #8                    *)
  (* 126c6c: *)         0x4ef98400; (*  add	v0.2d, v0.2d, v25.2d                          *)
  (* 126c70: *)         0xce6680a0; (*  sha512h	q0, q5, v6.2d                                 *)
  (* 126c74: *)         0x4e200af7; (*  rev64	v23.16b, v23.16b                              *)
  (* 126c78: *)         0x4ee08482; (*  add	v2.2d, v4.2d, v0.2d                           *)
  (* 126c7c: *)         0xce618480; (*  sha512h2	q0, q4, v1.2d                         *)
  (* 126c80: *)         0x4efa8400; (*  add	v0.2d, v0.2d, v26.2d                          *)
  (* 126c84: *)         0x4efb8421; (*  add	v1.2d, v1.2d, v27.2d                          *)
  (* 126c88: *)         0x4efc8442; (*  add	v2.2d, v2.2d, v28.2d                          *)
  (* 126c8c: *)         0x4efd8463; (*  add	v3.2d, v3.2d, v29.2d                          *)
  (* 126c90: *)         0xb5ffc382; (*  cbnz	x2, 126500 <sha512_block_armv8+0x40>          *)
  (* 126c94: *)         0x4c002c00; (*  st1	{v0.2d-v3.2d}, [x0]                           *)
  (* 126c98: *)         0xf84107fd; (*  ldr	x29, [sp], #16                                *)
  (* 126c9c: *)         0xd65f03c0; (*  ret                                                   *)

]

(* ---------------------------------------------------------------------- *)

(* Functions to help in program state initialization *)
let digest_size = 512;;

let adrp_base = (cb 64 0x126000);;
let (ktbl_pointer : State.mem_tracker) =
  { id = Some adrp_base; offset = (cb 64 (0x8e000 + 768)) };;

let sha512_block_armv8_init_state
    ~(num_blocks : airExp)
    ~(ctx_base : airExp)
    ~(input_base : airExp)
    ~(input : airExp list option) (* Least significant blocks first. *)
    (message : string) : State.t =

  (assert ((Option.is_none input) || (Air.is_concrete_value num_blocks)));

  let open State in

  (* num_bytes = num_blocks * 128 *)
  let num_bytes = (bvlsh 64 num_blocks (cb 32 7)) in

  let state =
    init
      ~stack_data_width:8
      ~stack_size:(Some (cb 64 32))
      ~stack_offset:(Some (cb 64 16))
      ~program_loc:0x1264c0
      ~program:sha512_block_armv8
      ~pc:0x1264c0
      "Initial State created for sha512_block_armv8." in
  let ctx_pointer = State.make_pointer ctx_base in
  let input_pointer = State.make_pointer input_base in
  (* ktbl data should eventually be copied over from the .rodata section. *)
  let ktbl = Cryptol.toAir2Dim Autospecs.SHA512rec.lowercase_K in
  let state =
    State.add_separate_mem_region
      ~name:"ctx_region" ~aw:64 ~dw:64
      ~base_addr:ctx_base ~size:(cb 64 (digest_size / 8)) ~alignment:16
      state
  in
  let state =
    State.add_separate_mem_region
      ~name:"input_region" ~aw:64 ~dw:64
      ~base_addr:input_base
      ~size:num_bytes
      ~alignment:16
      state
  in
  let state =
    State.add_separate_mem_region
      ~name:"ktbl_region" ~aw:64 ~dw:64
      ~base_addr:adrp_base
      ~size:(cb 64 (0x8e000 + 768 + ((List.length ktbl) * 8)))
      ~alignment:16
      state
  in
  let state =
    upd_gprs
      [
        (* x0: pointer to context *)
        (64, 0, ctx_pointer);
        (* x1: pointer to input *)
        (64, 1, input_pointer);
        (* Number of blocks. *)
        (64, 2, (State.make_gpr_data num_blocks));
      ]
      state
  in
  let h0 = Cryptol.toAir2Dim Autospecs.SHA512rec.lowercase_H0 in
  (* Initial hash value *)
  let state = write_mem_data (8 * 8) ctx_pointer (bvapp_list h0) state in
  (* Input block *)
  let state =
    if (Option.is_none input) then
      state
    else
      let input_length_bytes = (Z.to_int (Sem.Bv.to_z (get_cb_val num_bytes))) in
      write_mem_data input_length_bytes input_pointer (Air.bvapp_list (Option.get input)) state in
  (* 80 SHA512 constants *)
  (* TODO: There are located in the .rodata section of the program.
     We need to read in .rodata and load into the model's memory. *)
  let state = write_mem_data ((List.length ktbl) * 8) ktbl_pointer (bvapp_list ktbl) state in
  (Format.fprintf Format.std_formatter "@[%s@]@.@." message;
   state);;

(* ---------------------------------------------------------------------- *)
(* Some utility functions *)

let num_blocks_left (s : State.t) : airExp =
  let gpr2 = (State.gpr 64 2 s) in
  (assert (Option.is_none gpr2.id));
  gpr2.offset

let input_ptr (s : State.t) : State.mem_tracker =
  (State.gpr 64 1 s)

let input_offset (base_addr : airExp) (s : State.t) : airExp =
  let gpr1 = (input_ptr s) in
  (assert ((Option.get gpr1.id) = base_addr));
  gpr1.offset

let ktbl_offset (s : State.t) : airExp =
  let gpr3 = (State.gpr 64 3 s) in
  (assert (gpr3.id = ktbl_pointer.id));
  gpr3.offset

(* ---------------------------------------------------------------------- *)
