# Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
# SPDX-License-Identifier: Apache-2.0


# This workflow checks out the repository and runs an action that starts up the dockerfile for proofs

name: CI

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on: [push, pull_request]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    # Check out main repo and individually check out submodules.
    # Once all submodules are public, this can be replaced with a single checkout action with submodules:true
    - uses: actions/checkout@v2
      name: check out top-level repository
    - uses: actions/checkout@v2
      name: check out aws-lc source
      with: 
        repository: awslabs/aws-lc
        ssh-key: ${{ secrets.AWSLC_ACCESS_KEY }}
        path: ./src
    - uses: actions/checkout@v2
      name: check out cryptol specs
      with: 
        repository: GaloisInc/cryptol-specs
        path: ./cryptol-specs
        ref: 2e33ca77b5e81ed96d35073da3e09008afd4553f

    # Runs the formal verification action
    - name: Proofs
      uses: ./
